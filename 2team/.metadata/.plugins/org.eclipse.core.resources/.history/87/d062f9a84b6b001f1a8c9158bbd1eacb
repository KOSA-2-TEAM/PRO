package com.example._team.controller;

import com.example._team.domain.TravelBoard;
import com.example._team.domain.TravelImages;
import com.example._team.service.TravelImagesService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.util.List;

@Controller
@RequestMapping("/travel-images")
public class TravelImagesController {

    @Autowired
    private TravelImagesService travelImagesService;

    @PostMapping("/upload")
    public String uploadImages(@RequestParam("travelIdx") Integer travelIdx,
                               @RequestParam("images") List<MultipartFile> images) {
        TravelBoard travelBoard = new TravelBoard(); // Fetch the TravelBoard by ID
        travelBoard.setTravelIdx(travelIdx);
        travelImagesService.saveImages(images, travelBoard);
        return "redirect:/travel-boards/" + travelIdx;
    }

    @GetMapping("/{travelIdx}")
    public String getImagesByTravelBoard(@PathVariable Integer travelIdx, Model model) {
        TravelBoard travelBoard = new TravelBoard(); // Fetch the TravelBoard by ID
        travelBoard.setTravelIdx(travelIdx);
        List<TravelImages> images = travelImagesService.getImagesByTravelBoard(travelBoard);
        model.addAttribute("images", images);
        return "travel-images/list";
    }
}
