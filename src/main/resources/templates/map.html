<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Maps Address Search with Place Selection</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0;
    }
    h3 {
      color: #333;
    }
    #search-container {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 600px;
      margin: 0 auto;
      padding: 10px;
      background-color: #fff;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-radius: 8px;
    }
    #address {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-bottom: 10px;
      width: 100%;
    }
    #place-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #fff;
    }
    #place-list li {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: background-color 0.2s ease;
    }
    #place-list li:hover {
      background-color: #f9f9f9;
    }
    #place-list li:last-child {
      border-bottom: none;
    }
    button {
      padding: 10px 15px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #45a049;
    }
    #map {
      height: 500px;
      width: 100%;
      margin-top: 20px;
      border-radius: 8px;
    }
    .no-results {
      padding: 10px;
      color: red;
      text-align: center;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: #fff;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmUNKi79QJtTDCBYn4DHDnOi9gnT0KaII&libraries=places&callback=initMap" async defer></script>
  <script>
      let map;
      let service;
      let infowindow;
      let markers = [];
      let path = [];
      let polyline;
      let markerCounter = 1; // 마커 번호를 저장하는 전역 변수

      function initMap() {
        const seoul = new google.maps.LatLng(37.5665, 126.9780); // 서울 중심 좌표

        map = new google.maps.Map(document.getElementById("map"), {
          center: seoul,
          zoom: 13
        });

        infowindow = new google.maps.InfoWindow();

        // Polyline 객체를 생성하고 지도에 추가
        polyline = new google.maps.Polyline({
          path: path,
          geodesic: true,
          strokeColor: '#FF0000',
          strokeOpacity: 1.0,
          strokeWeight: 2,
        });
        polyline.setMap(map);
      }

      function searchPlace() {
        const placeName = document.getElementById("address").value;

        if (placeName === '') {
          document.getElementById('place-list').innerHTML = ''; // 입력값이 없을 시 목록을 비움
          return;
        }

        const request = {
          query: placeName,
          fields: ['name', 'geometry', 'place_id', 'formatted_address'],
        };

        service = new google.maps.places.PlacesService(map);
        service.findPlaceFromQuery(request, function(results, status) {
          if (status === google.maps.places.PlacesServiceStatus.OK) {
            displayPlaceList(results);
          } else if (status === google.maps.places.PlacesServiceStatus.ZERO_RESULTS) {
            displayNoResults(); // ZERO_RESULTS일 때 처리
          } else {
            console.error('Place search failed: ' + status);
          }
        });
      }

      function displayPlaceList(places) {
        const placeList = document.getElementById("place-list");
        placeList.innerHTML = ''; // 기존 목록을 지움

        // 검색된 장소들을 목록에 표시
        places.forEach((place, index) => {
          const listItem = document.createElement("li");
          listItem.textContent = `${place.name} - ${place.formatted_address}`;
          listItem.setAttribute("data-place-id", place.place_id);
          listItem.setAttribute("data-index", index);
          listItem.addEventListener("click", () => selectPlace(places[index])); // 마커 번호 전달
          placeList.appendChild(listItem);
        });
      }

      function displayNoResults() {
        const placeList = document.getElementById("place-list");
        placeList.innerHTML = ''; // 기존 목록을 지움

        // '결과 없음' 메시지 표시
        const noResultsItem = document.createElement("div");
        noResultsItem.classList.add("no-results");
        noResultsItem.textContent = "No places found. Please try another search.";
        placeList.appendChild(noResultsItem);
      }

      function selectPlace(place) {
        const location = place.geometry.location;

        // 지도 중심을 선택한 장소로 이동
        map.setCenter(location);

        // 마커 추가 (마커 번호를 Label로 설정)
        const marker = new google.maps.Marker({
          map: map,
          position: location,
          label: markerCounter.toString(), // 마커에 순서 번호 표시
        });
        markers.push(marker);

        // 경로에 새로운 좌표 추가
        path.push(location);
        polyline.setPath(path);

        // 마커 번호를 증가시켜 다음 마커에 다른 번호가 적용되도록 함
        markerCounter++;

        // 장소 정보창
        infowindow.setContent(place.name + "<br>" + place.formatted_address);
        infowindow.open(map, marker);
      }
  </script>
</head>
<body>
<h3 style="text-align: center;">Search for a Place</h3>
<div id="search-container">
  <input id="address" type="text" placeholder="Enter place name" oninput="searchPlace()" />
  <ul id="place-list"></ul>
</div>
<div id="map"></div>
</body>
</html>
