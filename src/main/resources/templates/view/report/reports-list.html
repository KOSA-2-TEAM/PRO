<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="/css/reports-list.css">
    <link rel="stylesheet" type="text/css" href="/css/footer.css">
    <title>신고글 관리자 게시판</title>
</head>
<body>
<div class="main-section">
    <section class="register-section" id="container">
        <header class="headr-title">
            <h1>신고글 관리자 게시판</h1>
        </header>
        <form id="actionForm" class="container" method="POST">
            <table class="table table-hover">
                <colgroup>
                    <col width=5%>
                    <col width=10%>
                    <col width=40%>
                    <col width=20%>
                    <col width=15%>
                    <col width=10%>
                </colgroup>
                <thead>
                <tr>
                    <th></th>
                    <th>신고 No.</th>
                    <th style="text-align: center">게시글 제목</th>
                    <th>신고 내용</th>
                    <th>신고 날짜</th>
                    <th>활성화</th>
                </tr>
                </thead>

                <tr th:if="${#lists.isEmpty(reportsList)}">
                    <td colspan="6" class="text-center">신고 게시글이 없습니다.</td>
                </tr>

                <tbody>
                <colgroup>
                    <col width=5%>
                    <col width=10%>
                    <col width=40%>
                    <col width=20%>
                    <col width=15%>
                    <col width=10%>
                </colgroup>
                <tr th:each="reports : ${reportsList}">
                    <td>
                        <input type="checkbox" class="chk" name="BoardIdx" th:value="${reports.reportsIdx}" onclick="chkClicked()">
                    </td>
                    <td th:text="${reports.reportsIdx}">신고 번호</td> <input type="hidden" name="deleteBoardIdx" th:value="${reports.reportsIdx}" />
                    <td>
                        <a th:href="@{/board/{id}(id=${reports.boardIdx.getBoardIdx()})}"
                           th:text="${reports.boardIdx.getTitle()}">게시글 제목</a>
                    </td>
                    <td th:text="${reports.content}">신고 내용</td>
                    <td th:text="${#temporals.format(reports.createdAt, 'yyyy-MM-dd')}">신고 날짜</td>
                    <td style="color: blue;" th:if="${reports.boardIdx.getStatus()==1}" th:text="활성"></td>
                    <td style="color: red;" th:if="${reports.boardIdx.getStatus()==0}" th:text="비활성"></td>
                </tr>
                </tbody>
            </table>
        </form>
        <section id="container-user">
            <!-- Left section for 전체 선택/해제 -->
            <div class="left-section">
                <label>
                    <input type="checkbox" id="allCheckBox" onclick="allChecked()">
                    전체 선택/해제
                </label>
            </div>
            <!-- Center section for pagination -->
            <div class="center-section" th:if="${page.totalPages > 1}">
                <ul class="pagination">
                    <!-- 이전 버튼 -->
                    <li class="page-item" th:class="${page.number == 0} ? 'disabled'">
                        <a class="page-link"
                           th:style="${page.number == 0} ? 'pointer-events: none;'"
                           th:href="@{/reports/list(page=${page.number-1})}">이전</a>
                    </li>

                    <!-- 페이지 번호 출력 -->
                    <li class="page-item" th:each="i : ${#numbers.sequence(1, page.totalPages)}"
                        th:classappend="${i == page.number + 1} ? 'active'">
                        <a class="page-link" th:href="@{/reports/list(page=${i-1})}" th:text="${i}">1</a>
                    </li>

                    <!-- 다음 버튼 -->
                    <li class="page-item" th:class="${page.number == page.totalPages - 1} ? 'disabled'">
                        <a class="page-link"
                           th:style="${page.number == page.totalPages - 1} ? 'pointer-events: none;'"
                           th:href="@{/reports/list(page=${page.number+1})}">다음</a>
                    </li>
                </ul>
            </div>
            <!-- Right section for buttons -->
            <div class="right-section">
                <button type="button" class="btn btn-danger" onclick="submitForm('/admin/reports/delete')">삭제</button>
                <button type="button" class="btn btn-primary" onclick="submitForm('/admin/reports/inactive')">활성/비활성</button>
            </div>
        </section>
    </section>
    <div th:replace="/fragments/footer :: bottomMenu"></div>
</div>
<script>
    //체크박스 전체 선택 클릭 이chkClicked벤트
    function allChecked(target) {
        const checkbox = document.getElementById('allCheckBox');  //전체 체크박스 버튼
        const is_checked = checkbox.checked; //전체 체크박스 버튼 체크 여부

        //전체 체크박스 제외한 모든 체크박스
        if (is_checked) {  // 체크박스 전체 체크
            chkAllChecked()
        } else { 	     //체크박스 전체 해제
            chkAllUnChecked()
        }
    }

    //자식 체크박스 클릭 이벤트
    function chkClicked() {
        const allCount = document.querySelectorAll(".chk").length; //체크박스 전체개수

        //체크된 체크박스 전체개수
        const query = 'input[name="chk"]:checked'
        const selectedElements = document.querySelectorAll(query)
        const selectedElementsCnt = selectedElements.length;

        //체크박스 전체개수와 체크된 체크박스 전체개수가 같으면 전체 체크박스 체크
        //같지않으면 전체 체크박스 해제
        if (allCount == selectedElementsCnt) {
            document.getElementById('allCheckBox').checked = true;
        } else {
            document.getElementById('allCheckBox').checked = false;
        }
    }

    //체크박스 전체 체크
    function chkAllChecked() {
        document.querySelectorAll(".chk").forEach(function (v, i) {
            v.checked = true;
        });
    }

    //체크박스 전체 체크 해제
    function chkAllUnChecked() {
        document.querySelectorAll(".chk").forEach(function (v, i) {
            v.checked = false;
        });
    }

    //버튼 2개 다르게 동작
    function submitForm(action) {
        const form = document.getElementById('actionForm');
        form.action = action; // 버튼 클릭에 따라 action을 변경
        form.submit(); // 폼 제출
    }
</script>
<script src="/js/scripts.js"></script>
</html>